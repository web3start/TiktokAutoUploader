from tiktok_uploader import cookies
import os
import json

# -----------------------------------------------------------------
# 1. 这是您从 Cookie-Editor 导出的 *完整* JSON 字符串。
# 我已经帮您粘贴在这里了。
json_cookie_string = """
[{"domain":".tiktok.com","expirationDate":1788856027.850451,"hostOnly":false,"httpOnly":false,"name":"_ttp","path":"/","sameSite":"no_restriction","secure":true,"session":false,"storeId":"0","value":"2ytBPgOQ8fG3HR0J1vHCePFXpl3"},{"domain":".tiktok.com","expirationDate":1777185642.5463,"hostOnly":false,"httpOnly":true,"name":"uid_tt","path":"/","sameSite":"unspecified","secure":true,"session":false,"storeId":"0","value":"a9b5e237f2a80eb918397afc6abca4202255f4552b39a336675ae9d138ac5702"},{"domain":".tiktok.com","expirationDate":1777185642.546387,"hostOnly":false,"httpOnly":true,"name":"uid_tt_ss","path":"/","sameSite":"no_restriction","secure":true,"session":false,"storeId":"0","value":"a9b5e237f2a80eb918397afc6abca4202255f4552b39a336675ae9d138ac5702"},{"domain":".tiktok.com","expirationDate":1777185642.546486,"hostOnly":false,"httpOnly":true,"name":"sid_tt","path":"/","sameSite":"unspecified","secure":true,"session":false,"storeId":"0","value":"ba3044be98d5566bc06d2dd943eefa10"},{"domain":".tiktok.com","expirationDate":1777185642.546611,"hostOnly":false,"httpOnly":true,"name":"sessionid","path":"/","sameSite":"unspecified","secure":true,"session":false,"storeId":"0","value":"ba3044be98d5566bc06d2dd943eefa10"},{"domain":".tiktok.com","expirationDate":1777185642.54668,"hostOnly":false,"httpOnly":true,"name":"sessionid_ss","path":"/","sameSite":"no_restriction","secure":true,"session":false,"storeId":"0","value":"ba3044be98d5566bc06d2dd943eefa10"},{"domain":".tiktok.com","expirationDate":1793175001.180969,"hostOnly":false,"httpOnly":true,"name":"store-idc","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"alisg"},{"domain":".tiktok.com","expirationDate":1793175001.181582,"hostOnly":false,"httpOnly":true,"name":"store-country-code","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"cn"},{"domain":".tiktok.com","expirationDate":1793175001.181812,"hostOnly":false,"httpOnly":true,"name":"store-country-code-src","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"uid"},{"domain":".tiktok.com","expirationDate":1793175001.182207,"hostOnly":false,"httpOnly":true,"name":"tt-target-idc","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"alisg"},{"domain":".tiktok.com","expirationDate":1793175001.182447,"hostOnly":false,"httpOnly":true,"name":"tt-target-idc-sign","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"imGpl-GgbKKg1louswj-tw1hDHbLsAiFQ14CphYCfsGlXZ7Wqp26uOCPLQugasDmOP02YwW-zFBMEefSBqk7M-iKq2G25k1YMus-qbQ3nb7tGbwNgQLqlKCu4USs7CIOOsGQzALgAZ5kp_-2Mt7sTKaaRyK4ia4dAPcsw423q2uxb76rDdw-620LCAIa9RJHjSuaLqftWqW5yN1jGOjgxUDeLQ53ox76TgIW-Uj4oszIqpT35BZPwz3fIap9mchiDxjYNIqv3Kirak_WvvfmQWCviwYWD7pqDSwm4__qEyHDOXOQz-y8WYt-gI6lTqYtyWcb_fKVKGK1pTgaa9oVJ6y3PVqVuLMr6GJ0enTRvbmm6IRnsUTJy0AH6c-nYL7CWKeNeUo7ck5kQm6stBc-6WesTGc6VYIZYPcyNQbCUvrOtTf6MQnU6ZNuQqwT-Il6QWChpCh2qhY1RH5azj2gi6kztWNb_JQG3WpJBuf4GfxkV6xCzLwiTCbFFHY4moXF"},{"domain":"www.tiktok.com","expirationDate":1762911880,"hostOnly":true,"httpOnly":false,"name":"last_login_method","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"google"},{"domain":".tiktok.com","expirationDate":1777190994.42669,"hostOnly":false,"httpOnly":true,"name":"tt_chain_token","path":"/","sameSite":"unspecified","secure":true,"session":false,"storeId":"0","value":"LqKeALyxm/0cZP1LxuaCjg=="},{"domain":".www.tiktok.com","expirationDate":1787558996,"hostOnly":false,"httpOnly":false,"name":"tiktok_webapp_theme","path":"/","sameSite":"unspecified","secure":true,"session":false,"storeId":"0","value":"dark"},{"domain":".www.tiktok.com","expirationDate":1781055908,"hostOnly":false,"httpOnly":false,"name":"delay_guest_mode_vid","path":"/","sameSite":"unspecified","secure":true,"session":false,"storeId":"0","value":"5"},{"domain":".www.tiktok.com","expirationDate":1787558996,"hostOnly":false,"httpOnly":false,"name":"tiktok_webapp_theme_source","path":"/","sameSite":"unspecified","secure":true,"session":false,"storeId":"0","value":"auto"},{"domain":".tiktok.com","hostOnly":false,"httpOnly":true,"name":"tt_csrf_token","path":"/","sameSite":"lax","secure":true,"session":true,"storeId":"0","value":"akXrov0Q-DsKmNTmnnM_vDs_SFNgqeeIjv2M"},{"domain":"www.tiktok.com","expirationDate":1792722171.278987,"hostOnly":true,"httpOnly":false,"name":"living_user_id","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"777423619824"},{"domain":".tiktok.com","expirationDate":1766742877.743458,"hostOnly":false,"httpOnly":false,"name":"passport_csrf_token","path":"/","sameSite":"no_restriction","secure":true,"session":false,"storeId":"0","value":"a80140d4d46dc613fcd27586e583cb1b"},{"domain":".tiktok.com","expirationDate":1766742877.743602,"hostOnly":false,"httpOnly":false,"name":"passport_csrf_token_default","path":"/","sameSite":"unspecified","secure":true,"session":false,"storeId":"0","value":"a80140d4d46dc613fcd27586e583cb1b"},{"domain":".tiktok.com","hostOnly":false,"httpOnly":false,"name":"s_v_web_id","path":"/","sameSite":"no_restriction","secure":true,"session":true,"storeId":"0","value":"verify_mh8yo8u1_OKuCohZu_hJ2z_4Onh_BqSn_KyGfWUfquWNT"},{"domain":".tiktok.com","expirationDate":1792737642.54612,"hostOnly":false,"httpOnly":true,"name":"sid_guard","path":"/","sameSite":"unspecified","secure":true,"session":false,"storeId":"0","value":"ba3044be98d5566bc06d2dd943eefa10%7C1761633626%7C15552000%7CSun%2C+26-Apr-2026+06%3A40%3A26+GMT"},{"domain":".tiktok.com","expirationDate":1777185642.546745,"hostOnly":false,"httpOnly":true,"name":"tt_session_tlb_tag","path":"/","sameSite":"unspecified","secure":true,"session":false,"storeId":"0","value":"sttt%7C2%7CujBEvpjVVmvAbS3ZQ-76EP________-nqajnxOi0KvQw1no0BLZFUV5yyOeJlTtUJAR0rS-Sd1g%3D"},{"domain":".tiktok.com","expirationDate":1777185642.546882,"hostOnly":false,"httpOnly":true,"name":"sid_ucp_v1","path":"/","sameSite":"unspecified","secure":true,"session":false,"storeId":"0","value":"1.0.0-KDJlN2NiM2ZmOTIxYzVkNWQ5MDA5YmZkODE0ZjBhZTgwMjIyNTg3ZWMKGQiCgKaY6JHptFwQ2sqByAYYsws4CEASSAQQAxoCbXkiIGJhMzA0NGJlOThkNTU2NmJjMDZkMmRkOTQzZWVmYTEw"},{"domain":".tiktok.com","expirationDate":1777185642.546961,"hostOnly":false,"httpOnly":true,"name":"ssid_ucp_v1","path":"/","sameSite":"no_restriction","secure":true,"session":false,"storeId":"0","value":"1.0.0-KDJlN2NiM2ZmOTIxYzVkNWQ5MDA5YmZkODE0ZjBhZTgwMjIyNTg3ZWMKGQiCgKaY6JHptFwQ2sqByAYYsws4CEASSAQQAxoCbXkiIGJhMzA0NGJlOThkNTU2NmJjMDZkMmRkOTQzZWVmYTEw"},{"domain":".www.tiktok.com","expirationDate":1762242547,"hostOnly":false,"httpOnly":false,"name":"__tea_cache_tokens_1988","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"{%22web_id%22:%227538250517584872974%22%2C%22user_unique_id%22:%227538250517584872974%22%2C%22timestamp%22:1761637709925%2C%22_type_%22:%22default%22}"},{"domain":".tiktok.com","expirationDate":1793175000.054464,"hostOnly":false,"httpOnly":true,"name":"ttwid","path":"/","sameSite":"no_restriction","secure":true,"session":false,"storeId":"0","value":"1%7COBd8x-vY_nHG3uK0mDxTxIXllRdY_EAkrRCLYaRmZhw%7C1761638984%7Ceb4c8c9f0b5b57e985f71b6000487885f2383c2818f895db20648cd667c2a854"},{"domain":".tiktok.com","expirationDate":1793175001.181321,"hostOnly":false,"httpOnly":true,"name":"store-country-sign","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"MEIEDJge5hqBHnLu7Ip6PgQgiuXxAQCKhK1XnYPCajfacyahNWB5fiP8vwQitN6S2a0EEJJzP8vu3os5wAdn5UUlYuM"},{"domain":".www.tiktok.com","expirationDate":1762243801,"hostOnly":false,"httpOnly":false,"name":"perf_feed_cache","path":"/","sameSite":"unspecified","secure":true,"session":false,"storeId":"0","value":"{%22expireTimestamp%22:1761811200000%2C%22itemIds%22:[%227565803970262863111%22%2C%227533458250532949249%22%2C%227565325333566672146%22]}"},{"domain":"www.tiktok.com","expirationDate":1769415005,"hostOnly":true,"httpOnly":false,"name":"msToken","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"lUasc2a94nPPSjVy_6gWN34yHY1pC_U55kSZYyM2GYfZVIPr8K2OVOMaI-TBPqD_IL2u7xC-0Sj5z6PZEy_7njOIVMMvlCkw5Kb-Qbd0A3V5Bk8Mp5neMn5qH0fX5WjtgHkdcYhy4Iph9FR8hmAlZ4Uz8Q=="},{"domain":".www.tiktok.com","hostOnly":false,"httpOnly":false,"name":"passport_fe_beating_status","path":"/","sameSite":"unspecified","secure":false,"session":true,"storeId":"0","value":"false"},{"domain":".tiktok.com","expirationDate":1762503008.585873,"hostOnly":false,"httpOnly":false,"name":"msToken","path":"/","sameSite":"no_restriction","secure":true,"session":false,"storeId":"0","value":"c-xV4zUal4cQIBEbO3IHrNluTAOKkeHP6mBmGwdLRgzIldbVpUeTgYY_J6rZsNSPEIIlvLJM82_c4r9iW314weTKNS1vg5mq14xFUM_AoikY4U6rpeqG2oQjIM1O"},{"domain":".tiktok.com","expirationDate":1793177847.231971,"hostOnly":false,"httpOnly":true,"name":"odin_tt","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"d008a7d5070b58fdeb16f5b0e890e0314deffd158a47019e220aea0823a9e1ded677279a71a2ea70581d4ccecc393cfd3d71c010699fa3be59a4a388eabc004fdef9c30f5b801c7af6294b064a1f5330"}]
"""
# -----------------------------------------------------------------

# 2. 转换格式
my_cookie_list_raw = json.loads(json_cookie_string)
my_cookie_list_processed = []


# --- 修复代码：过滤掉导致冲突的 'msToken' ---
filtered_list_raw = [
    cookie for cookie in my_cookie_list_raw 
    if not (cookie.get('name') == 'msToken' and cookie.get('domain') == 'www.tiktok.com')
]
# --- 修复代码结束 ---


# 3. 遍历这个 *过滤后* 的列表
for cookie in filtered_list_raw:
    # 移除 'storeId' 和 'session' (如果存在)
    cookie.pop('storeId', None)
    cookie.pop('session', None)

    # 关键：重命名 'expirationDate' 为 'expiry'
    if 'expirationDate' in cookie:
        cookie['expiry'] = int(cookie.pop('expirationDate'))

    my_cookie_list_processed.append(cookie)


# 4. 使用正确的命名规则
login_name = "ipanda"
filename_to_save = f"tiktok_session-{login_name}"


# 5. 调用函数保存文件 (使用处理过的列表)
cookies.save_cookies_to_file(my_cookie_list_processed, filename_to_save)

print(f"成功为用户 '{login_name}' 手动创建了 *已修复* 的 cookie 文件。")
